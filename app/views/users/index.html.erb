<table class="table table-striped">
  <thead class="thead-dark">
  <tr>
    <th><h4>Your Followers (<%= current_user.followers_count %>)</h4></th>
    <th><h4>You Following (<%= current_user.followees_count %>)</h4></th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>
      <% current_user.followers.each do |follower| %>
        <%= follower.email %><br>
      <% end %>
    </td>
    <td>
      <% current_user.followees.each do |followee| %>
        <%= followee.email %><br>
      <% end %>
    </td>
  </tr>
  </tbody>
</table>

<br><hr><br>
<h3><strong>Available Users</strong></h3>
  <table class="table table-striped">
    <thead class="thead-dark">
    <tr>
      <th>User</th>
      <th>Followers</th>
      <th>Following</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <% @user.each do |user| %>  <% next if user == current_user %>
      <tr>
        <td><%= user.email %></td>
        <td>
          <%= user.followers_count %> (
          <% follower_emails = user.followers.pluck(:email) %>
          <%= follower_emails.join(', ') %>
          )
        </td>
        <td>
          <%= user.followees_count %> (
          <% followees_emails = user.followees.pluck(:email) %>
          <%= followees_emails.join(', ') %>
          )
        </td>
        <td>
          <% if current_user.followees.include?(user) %>
            <%= button_to "Unfollow", unfollow_user_path(user), method: :post, class: "btn btn-danger btn-sm", style: "display: inline-block;" %>
          <% else %>
            <%= button_to "Follow", follow_user_path(user), method: :post, class: "btn btn-success btn-sm", style: "display: inline-block;" %>
          <% end %>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>

<br><hr><br>

  <h3><strong>What's on your mind ?</strong></h3>
  <%= render partial: 'tweet_form', locals: { tweet: @tweet } %>
  <%= link_to 'PfSense', 'http://192.168.10.1', target: '_blank', class: 'btn btn-primary' %>

<br><hr><br>

  <h3><strong>All Tweets</strong></h3>
  <table class="table table-striped">
    <thead>
    <tr>
      <th>Tweet</th>
      <th>Posted By</th>
      <th>At</th>
      <% if current_user.present? %>
        <th>Actions</th>
      <% end %>
    </tr>
    </thead>
    <tbody>
    <% @tweets.each do |tweet| %>
      <tr>
        <td><%= tweet.content %></td>
        <td><%= tweet.user.email %></td>
        <td><%= tweet.updated_at.strftime("%d-%m-%Y %H:%M:%S") %></td>
        <% if current_user.present? && tweet.user == current_user %>
          <td>
            <div class="actions">
              <%= link_to "Edit", edit_user_tweet_path(tweet.user, tweet), class: "btn btn-primary btn-sm" %>
              <%= button_to "Delete", user_tweet_path(tweet.user, tweet), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-danger btn-sm" %>
            </div>
          </td>
        <% else %>
          <td>Permission denied</td>
        <% end %>
      </tr>
    <% end %>
    </tbody>
  </table>
</div>
